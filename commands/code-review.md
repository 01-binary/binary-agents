---
description: 여러 전문 에이전트를 병렬로 실행하여 종합 코드 리뷰 수행
allowed-tools: Task, Skill, Read, Glob, Grep
---

# 종합 코드 리뷰

여러 전문 리뷰 에이전트를 병렬로 실행하여 포괄적인 분석을 제공하는 코드 리뷰 오케스트레이터입니다.

## 컨텍스트 정보

**리뷰 대상 경로:**
!`echo "${1:-.}"`

**현재 git 상태:**
!`git status --short | head -20`

**변경된 파일 (있는 경우):**
!`git diff --name-only HEAD~1 2>/dev/null || echo "최근 커밋 없음"`

## 사용 가능한 리뷰 에이전트

Task 도구를 통해 다음 전문 에이전트를 사용할 수 있습니다:

| Agent | 초점 영역 | 모델 |
|-------|----------|------|
| `code-reviewer` | 아키텍처, 타입 안전성, 에러 처리, 테스트, 접근성, 보안 | opus |
| `refactor-analyzer` | 코드 중복, 복잡성, 추상화 기회, 코드 스멜 | opus |
| `junior-checker` | 주니어 개발자 관점 가독성, 네이밍, 복잡도 | opus |
| `fundamentals-code` | Toss Frontend Fundamentals 기반 (가독성, 예측 가능성, 응집도, 결합도) | opus |
| `react-performance-optimizer` | React 리렌더, 메모이제이션, 훅 최적화 | opus |
| `react-principles-reviewer` | React 개발 원칙 (응집도/명시성, Props 관리, 네이밍, 부수효과, AsyncBoundary) | opus |
| `maintainable-code-reviewer` | 유지보수성 (UI-코드 1:1 대응, 분리의 4원칙, 추상화 원칙) | opus |

## 사용 가능한 Skill

Skill은 사용자 설치에 따라 다르며 추가 리뷰 가이드라인/컨텍스트를 제공합니다:
- `vercel-react-best-practices` - Vercel의 React/Next.js 최적화 가이드라인
- 커스텀 팀 코딩 표준
- 프레임워크별 best practices

**참고:** Skill은 Skill 도구로 로드되며 직접 분석이 아닌 리뷰 컨텍스트를 제공합니다.

## 작업 순서

1. **리뷰 범위 결정**
   - **경로가 제공된 경우:** 해당 경로의 모든 파일을 리뷰
   - **경로가 없는 경우:** 현재 작업 디렉토리 전체를 리뷰

   > **중요:** git 변경사항에 제한하지 마세요. 대상 경로의 모든 파일을 리뷰합니다.

2. **사용자에게 리뷰 유형 질문** (AskUserQuestion 사용)

   옵션 제시:

   | 옵션 | 이름 | 사용 에이전트 | 적합한 상황 |
   |------|------|--------------|-------------|
   | 1 | **전체 리뷰** | 모든 7개 에이전트 병렬 실행 | 종합 코드 리뷰 (권장) |
   | 2 | **커스텀** | 사용자가 직접 선택 | 특정 관점만 리뷰하고 싶을 때 |

3. **Skill 포함 여부 질문** (AskUserQuestion 사용)

   리뷰 유형 선택 후:
   > "포함할 skill이 있나요? (예: `vercel-react-best-practices`, 팀 코딩 가이드 등)"

   옵션:
   - **없음** - skill 없이 에이전트만 실행
   - **있음** - skill 이름 입력받아서 로드

   사용자가 skill 이름 제공 시:
   - 에이전트 실행 전 `Skill(<skill-name>)`으로 각 skill 로드
   - Skill은 리뷰를 위한 추가 컨텍스트/가이드라인 제공

4. **선택된 에이전트 병렬 실행**
   - Task 도구로 여러 에이전트를 동시에 생성
   - 각 에이전트는 동일한 대상 경로/파일 분석
   - 각 에이전트 프롬프트 예시:
     ```
     [path] 코드를 리뷰하세요. [에이전트별 초점 영역]에 집중하세요.
     file:line 참조와 함께 발견사항을 제공하세요.
     ```

5. **결과 집계 및 종합**
   - 모든 에이전트 완료 대기
   - 발견사항을 통합 리포트로 결합
   - 중복 발견사항 제거
   - 심각도와 영향도로 우선순위 정렬

## 출력 형식

### Phase 1: 리뷰 유형 선택
AskUserQuestion으로 원하는 리뷰 유형 질문.

### Phase 2: Skill 선택
AskUserQuestion으로 포함할 skill 여부 질문.

### Phase 3: 실행
에이전트 실행 중 진행 상황 표시:
```
리뷰 실행 중...
├── code-reviewer: 완료
├── fundamentals-code: 실행 중...
├── refactor-analyzer: 완료
└── junior-checker: 대기 중
```

### Phase 4: 최종 리포트

```markdown
# 종합 코드 리뷰 결과

## 요약
- **리뷰 대상:** [path]
- **실행된 에이전트:** [list]
- **총 발견 사항:** N개 (Critical: X, Warning: Y, Info: Z)

---

## Critical Issues (즉시 수정 필요)

### 1. [Issue Title]
- **발견 에이전트:** [agent name]
- **위치:** [file:line]
- **문제:** [description]
- **해결 방안:** [recommendation]

---

## Warnings (개선 권장)

### 1. [Issue Title]
- **발견 에이전트:** [agent name]
- **위치:** [file:line]
- **문제:** [description]
- **해결 방안:** [recommendation]

---

## Good Practices (잘한 점)

- [Good practice 1] - [file:line]
- [Good practice 2] - [file:line]

---

## 에이전트별 상세 결과

### Code Reviewer
[발견사항 요약]

### Fundamentals Code
[발견사항 요약]

### Refactor Analyzer
[발견사항 요약]

...

---

## 우선순위 개선 항목

1. **[최우선]** [Issue] - [file]
2. **[높음]** [Issue] - [file]
3. **[보통]** [Issue] - [file]
```

## 도구 사용 예시

### 에이전트 생성 (Task 도구)

에이전트 생성 시 이 패턴 사용:

```
// 여러 에이전트를 병렬로 실행 (단일 메시지, 다중 Task 호출)
Task(code-reviewer): "src/components 코드를 리뷰하세요. 아키텍처, 타입 안전성, 에러 처리, 접근성, 보안에 집중하세요. file:line 참조와 함께 발견사항을 반환하세요."

Task(fundamentals-code): "src/components를 Toss Frontend Fundamentals 원칙으로 분석하세요. 가독성, 예측 가능성, 응집도, 결합도를 확인하세요. file:line 참조와 함께 발견사항을 반환하세요."

Task(refactor-analyzer): "src/components의 리팩토링 기회를 분석하세요. 코드 중복, 복잡성, 추상화 기회를 확인하세요. file:line 참조와 함께 발견사항을 반환하세요."

Task(react-principles-reviewer): "src/components를 React 개발 원칙으로 리뷰하세요. 응집도/명시성 패턴, Props 관리, 네이밍 원칙, 부수효과 위치, AsyncBoundary 사용을 확인하세요. file:line 참조와 함께 발견사항을 반환하세요."
```

### Skill 로드 (Skill 도구)

사용자가 포함할 skill을 지정하면 추가 리뷰 가이드라인을 위해 로드:

```
// 예시: 사용자가 지정한 skill 로드
Skill(<skill-name>): 리뷰 중 이 skill의 가이드라인을 적용하기 위해 로드합니다.
```

**팁:** 사용자에게 포함할 skill이 있는지 물어본 후 에이전트 생성 전에 로드하세요.

## 중요 사항

- **병렬 실행이 핵심** - 효율성을 위해 항상 에이전트를 병렬로 생성
- **발견사항 중복 제거** - 여러 에이전트가 동일한 이슈를 찾을 수 있음
- **file:line 참조 보존** - 실행 가능한 피드백을 위해 필수
- **한국어 출력** - 최종 리포트는 한국어로
- **AI attribution 금지** - "Generated by AI" footer 추가 금지
- **결과 파일 저장** - 최종 리포트를 `code-review.md` 파일로 저장 (이미 존재하면 `---` 구분선과 함께 하단에 추가)
